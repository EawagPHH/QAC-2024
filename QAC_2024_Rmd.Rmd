---
title: "Untitled"
author: "Anne Vescovi"
date: "2024-09-10"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



#Load packages
```{r load packages ,echo=FALSE}}
if (!require(readxl)) install.packages("readxl")
library (readxl)

if (!require(tidyverse)) install.packages("tidyverse")
library(tidyverse)
if (!require(reshape2)) install.packages("reshape2")
library(reshape2)
if (!require(ggplot2)) install.packages("ggplot2")
library(ggplot2)
if (!require(hrbrthemes)) install.packages("hrbrthemes")
library(hrbrthemes)

#if (!require(plyr)) install.packages('plyr')
#library(plyr)
if (!require(tidyr)) install.packages('tidyr')

#if (!require(scales)) install.packages("scales")   
library(scales)
library(ggrepel)
library(gridExtra)
```

#get data 
```{r}
dat <- read_excel("20240723_AV_analysis_dataset_QAC_deactivation.xlsx",sheet = "Data Points")
viruses <- read_excel("20240723_AV_analysis_dataset_QAC_deactivation.xlsx",sheet = "virus properties")
```

#manioulate data

##setting fixed values
```{r}
dat$Temp[dat$Temp=="RT"] = 22
dat$CT = dat$`C (mg/L)`* dat$`time (min)`

#####logll Setting 0 and negative LRV Values to 0.1 to be able to calculate with them 
logll = as.numeric(dat$log)
logll[ is.na( dat$log ) ] = as.numeric(dat$`LOD/LOQ`[ is.na(dat$log)])
logll [logll == 0] = 0.1
logll [logll < 0] = 0.1



dat.log <- as.numeric(dat$log[! is.na( dat$log ) ])
dat.logLOD <- as.numeric(dat$`LOD/LOQ`[! is.na( dat$`LOD/LOQ`)])
```

##connecting datasets
```{r}
#######connect Virus names with size
sizefordat = array(NA,dim(dat)[1])
for(i in 1:dim(viruses)[1]){
  sizeTMP = viruses$`Size`[i]
  StrainTMP = viruses$`VirusName`[i]
  if( !is.na(StrainTMP)){
    whc1 = dat$`VirusName` == StrainTMP
    sizefordat[whc1] = sizeTMP
  }
}
#whc1 = dat$nick == nickTMP is a vector that has the same length as dat$nick with true or false
# if it is true write size 


#######connect names with geom size
Gsizefordat = array(NA,dim(dat)[1])
for(i in 1:dim(viruses)[1]){
  GsizeTMP = viruses$Gsize[i]
  nickTMP = viruses$`VirusName`[i]
  if( !is.na(nickTMP)){
    whc1 = dat$`VirusName` == nickTMP
    Gsizefordat[whc1] = GsizeTMP
  }
}

#######connect nucleid acid
DNAfordat = array(NA,dim(dat)[1])
for(i in 1:dim(viruses)[1]){
  dnaTMP = viruses$`Nacid`[i]
  nickTMP = viruses$`VirusName`[i]
  if( !is.na(nickTMP)){
    whc1 = dat$`VirusName` == nickTMP
    DNAfordat[whc1] = dnaTMP
  }
}

#######connect family names with data point
famfordat = array(NA,dim(dat)[1])
for(i in 1:dim(viruses)[1]){
  famTMP = viruses$Family[i]
  nickTMP = viruses$`VirusName`[i]
  if( !is.na(nickTMP)){
    whc1 = dat$`VirusName` == nickTMP
    famfordat[whc1] = famTMP
  }
}

```

##connect strings to dat
```{r}
# add new variables to the data frame
dat$size <- as.numeric(c(sizefordat))
dat$size10 <-  as.numeric(c(sizefordat))* 0.01
dat$nacid <- c(DNAfordat)
dat$logll <- as.numeric(c(logll))
dat$log <- as.numeric(c(dat$log))
dat$Gsize <- as.numeric(c(Gsizefordat))
dat$fam <- c(famfordat)



```

##create binary data for regression analysis
```{r}
#make measurement method and carbon load binary
dat$measurement <-ifelse(dat$measurement == "c", 1,0)
dat$Surface <-ifelse(dat$Surface == "e", 1,0)

#create one binary colom for each QAC
idx <- sort(unique(dat$QAC))
dummy <- matrix(NA, nrow= nrow(dat), ncol =length(idx))
colnames(dummy) <- c(idx)

for (j in 1:length(idx)) { 
  dummy[,j] <- as.integer(dat$QAC == idx[j])
}

dat <- cbind(dat,dummy)



#create binary colom for each nacid type
idx <- sort(unique(dat$nacid))
dummy <- matrix(NA, nrow= nrow(dat), ncol =length(idx))
colnames(dummy) <- c(idx)

for (j in 1:length(idx)) { 
  dummy[,j] <- as.integer(dat$nacid == idx[j])
}

dat <- cbind(dat,dummy)

```

##create LOD binary vector
```{r}
make_limit <- function(LOD ){
  dplyr::case_when(LOD > -10 ~ "LOD",
                     TRUE ~ "NO LOD")
}

dat <- dat %>%
  dplyr::mutate(LOD = make_limit( `LOD/LOQ`
                                       ))
```

##delete cases without size

```{r}
# Find indices of rows with NA in dat$size
na_indices <- which(is.na(dat$size))


# Optionally, view the rows with NA in dat$size
dat[na_indices, ]

dat <- subset(dat, (!is.na(dat$size)))

```
##create subsets
```{r}
dat.e <- dat[dat$Surface == "1",]
dat.n <- dat[dat$Surface == "0",] 
subsetlog <- subset(dat, (!is.na(dat$log)))
subsetlogLOD <- subset(dat, (!is.na(dat$logLOD)))
subsetcarbon <- subset(dat, (is.na(dat$matrix)))
```



##clean up
```{r}
#clean up
rm(dnaTMP)
rm (i)
rm (nickTMP)
rm(sizeTMP)
rm(whc1)
rm(famTMP)
rm(GsizeTMP)
rm(DNAfordat)
rm(famfordat)
rm(Gsizefordat)
rm(dat.log)
rm(dat.logLOD)
rm(logll)
rm(sizefordat)
rm(tablenick)
rm(idx)
rm(j, StrainTMP)
rm(dummy)
```
#distributions
```{r}
#different QACs
table(dat$QAC)
dim(table(dat$QAC))


dim(table(dat$VirusName))

summary(table(dat$`LOD/LOQ`))

dim(table(dat$fam))

###### size 
mean(dat$size, na.rm=TRUE)
sd(dat$size, na.rm=TRUE)
mean(dat.e$size, na.rm=TRUE)
sd(dat.e$size, na.rm=TRUE)
mean(dat.n$size, na.rm=TRUE)
sd(dat.n$size, na.rm=TRUE)

filtered_size <- dat[dat$size > 200, ]
dim(filtered_size)

filtered_size <- dat[dat$size < 50, ]
dim(filtered_size)

filtered_size <- dat[dat$size >= 50 & dat$size <100, ]
dim(filtered_size)
filtered_size <- dat[dat$size >= 100 & dat$size <150, ]
dim(filtered_size)
filtered_size <- dat[dat$size >= 150 & dat$size <200, ]
dim(filtered_size)
filtered_size <- dat[dat$size >= 200 & dat$size <250, ]
dim(filtered_size)
filtered_size <- dat[dat$size > 250, ]
dim(filtered_size)

#number of studies included enveloped or nonenveloped data


dim(table(dat.e$`Studies by number`))
dim(table(dat.n$`Studies by number`))

table(dat.e$`Studies by number`)
table(dat.n$`Studies by number`)


# nacid 
table(dat$nacid)

#gzize
table(dat$Gsize)

  # Step 1: Filter for Gzize smaller than 50
  filtered_viruses <- dat[dat$Gsize < 50, ]
  
  # Step 2: Get unique rows based on VirusName
  unique_viruses <- filtered_viruses[!duplicated(filtered_viruses$VirusName), ]
  
  # View the result
  print(unique_viruses)
  
#Tempreture 
dat$Temp <- as.numeric(dat$Temp)
  
dim(dat[dat$Temp >= 20 & dat$Temp <=25, ])
dim(dat[dat$Temp ==37, ])
dim(dat[dat$Temp >= 0 & dat$Temp <=5 , ])  
dim(dat[dat$Temp > 25 & dat$Temp <37 , ]) 
dim(dat[dat$Temp >37, ])


#carbon load 

dim(dat [ !is.na(dat$`carbon load`), ])

filtered_carbon <- dat [ !is.na(dat$`carbon load`), ]

unique_studies <- filtered_carbon[!duplicated(filtered_carbon$`Studies by number`), ]
print(unique_studies)


# surface material

dim(dat [ is.na(dat$material), ]) #datapoints without surface material == in liquid solution
filtered_material <- dat [ !is.na(dat$material), ]

unique_studies <- filtered_material[!duplicated(filtered_material$`Studies by number`), ]
print(unique_studies)



#QAC type 

table(dat$QAC)

filtered_bac <- dat [ dat$QAC == "DDAB", ]
dim(filtered_bac)
unique_studies <- filtered_bac[!duplicated(filtered_bac$`Studies by number`), ]
print(unique_studies)


```
#plots
##Viruses over LOG

###data manipulation 

```{r}
my_subset <- subset(dat, select = c("Abbreviation", "logll","log", "LOD","Surface"))
my_subset$Surface <- as.character(my_subset$Surface)

#my_subset2 <- subset(dat, select = c("VirusName", "logll"))


# Calculate median of logll column for each Abbreviation class
#median_logll <- aggregate(dat$logll, by=list(dat$Abbreviation), FUN=median)
# Rename the columns in the result
#colnames(median_logll) <- c("Abbreviation", "MedianLogll")
# Sort the result by median logll values in descending order
#sorted_median_logll <- median_logll[order(-median_logll$MedianLogll), ]
# Print the sorted result
#print(sorted_median_logll)



sorted_median_logll <- with(my_subset, reorder(Abbreviation, logll, median))

# Reorder Abbreviation levels based on sorted median logll values
my_subset$Abbreviation <- factor(my_subset$Abbreviation, levels = levels(sorted_median_logll))


ggplot(my_subset, aes(x = Abbreviation, y = logll)) + 
  geom_point(size = 2) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) 


```

###plot geom_point
```{r}

ggplot(my_subset, aes(x = Abbreviation, y = logll, colour= Surface, shape =LOD)) + 
  geom_point(size = 2) +
  # theme_ipsum(axis= TRUE,
  #           grid = FALSE, axis_text_size = 11, 
  #          axis_title_size = 11,
  #         axis_col = "black"
  #        )+ 
  # theme(
  #  legend.position = "none",
  # legend.title=element_blank(),
  #panel.grid.major = element_blank(),
  #panel.grid.minor = element_blank(),
  #axis.text.x = element_text(angle = 90, hjust = 1)
theme_bw() + 
  theme(
    axis.text.x = element_text(angle = 90, size = 11 ),
    axis.title.x = element_blank(),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank()
  )+
  scale_shape_manual(
    values = c(1, 20),
    labels = c( " LOD ", "no LOD")
  ) +
  scale_color_manual(
    labels = c( " nonenveloped ", "enveloped"),
    values =  c('blue', 'black' )
  ) ->F1
F1

ggsave("VirusesOverLog.jpeg", plot = F1,
       scale = 1, width = 40, height = 20, units = "cm", dpi = 1200)

```
```{r}
ggplot(my_subset, aes(x = Abbreviation, y = logll, colour= LOD, shape =LOD)) + 
  geom_point(size = 2) +
  # theme_ipsum(axis= TRUE,
   #           grid = FALSE, axis_text_size = 11, 
    #          axis_title_size = 11,
     #         axis_col = "black"
      #        )+ 
   # theme(
    #  legend.position = "none",
    # legend.title=element_blank(),
    #panel.grid.major = element_blank(),
    #panel.grid.minor = element_blank(),
    #axis.text.x = element_text(angle = 90, hjust = 1)
  theme_bw() + 
  theme(
    axis.text.x = element_text(angle = 90, size = 11 ),
    axis.title.x = element_blank(),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank()
        )+
   scale_shape_manual(
    values = c(1, 20),
    labels = c( " LOD ", "no LOD")
  ) +
 scale_color_manual(
   labels = c( " LOD ", "no LOD"),
     values =  c('darkviolet', 'black' )
     )  ->F2

F2
```




###plot boxplot without LODs
```{r}
library(forcats)

my_subset$log <- as.numeric(my_subset$log )

# Remove rows with missing values in logll
my_subset <- na.omit(my_subset, cols = "log")

# Reorder Abbreviation based on the mean of logll across all data points
my_subset$Abbreviation <- fct_reorder(my_subset$Abbreviation, my_subset$log, .fun = mean)


ggplot(my_subset, aes(x = Abbreviation, y = log, fill=Surface)) + 
  geom_boxplot( alpha = 0.4) +
  geom_point(aes(shape=Surface), position = position_jitterdodge(jitter.width = 0.2), size = 2, alpha=0.7) +
  # theme_ipsum(axis= TRUE,
  #           grid = FALSE, axis_text_size = 11, 
  #          axis_title_size = 11,
  #         axis_col = "black"
  #        )+ 
  # theme(
  #  legend.position = "none",
  # legend.title=element_blank(),
  #panel.grid.major = element_blank(),
  #panel.grid.minor = element_blank(),
  #axis.text.x = element_text(angle = 90, hjust = 1)
theme_bw() + 
  theme(
    axis.text.x = element_text(angle = 90, size = 11 ),
    axis.title.x = element_blank(),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank()
  )+
  scale_shape_manual(
    values = c(1, 20),
    labels = c( " nonenveloped ", "enveloped")
  ) +
  scale_fill_manual(
    labels = c( " nonenveloped ", "enveloped"),
    values =  c('blue', 'black' )
  )  -> F3
F3


ggsave("VirusesOverLog_boxplotM1.jpeg", plot = F3,
       scale = 1, width = 40, height = 20, units = "cm", dpi = 1200)

```

###plot subgroups log over ct


```{r}

subset_with_more_than_3 <- dat %>%
  group_by(Abbreviation) %>%
  filter(n() > 3) %>%
  ungroup()

subset_with_more_than_3$Abbreviation2 <- subset_with_more_than_3$Abbreviation



sorted_median_logll <- with(subset_with_more_than_3, reorder(Abbreviation, logll, median))
# Reorder Abbreviation levels based on sorted median logll values
subset_with_more_than_3$Abbreviation <- factor(subset_with_more_than_3$Abbreviation, levels = levels(sorted_median_logll))



p <- (ggplot(subset_with_more_than_3, aes(x=CT, y=logll, group=Abbreviation2)) +
        geom_point(size=0.9, alpha=0.8,
                  data=subset_with_more_than_3[, c("CT", "logll", "Abbreviation2")], color="grey") +
        geom_point(aes (color=Title) ,size=1.1) +
        ylab("") +
        theme_bw() +
        scale_x_log10()+
        theme(panel.border=element_blank()) +
        theme(strip.background=element_blank()) +
        facet_wrap(~ Abbreviation))
p


ggsave("logANDct_temp.jpeg", plot = p,
       scale = 1, width = 40, height = 40, units = "cm", dpi = 1200)

```




###plot log over CT subsets by nacid coloured by name 
```{r}


table(dat$nacid)

subset_with_more_than <- dat %>%
  group_by(Abbreviation) %>%
  filter(n() > 8) %>%
  ungroup()

subsetNaciddsRNA <- subset_with_more_than[subset_with_more_than$nacid == "dsRNA",]

ggplot(subsetNaciddsRNA, aes(x = CT, y = logll, fill=Abbreviation)) + 
  #geom_boxplot( alpha = 0.4) +
  geom_point(aes(colour=Abbreviation, shape=LOD), position = position_jitterdodge(jitter.width = 0.2), size = 2, alpha=0.7) +
  scale_x_log10()+
  # theme_ipsum(axis= TRUE,
  #           grid = FALSE, axis_text_size = 11, 
  #          axis_title_size = 11,
  #         axis_col = "black"
  #        )+ 
  # theme(
  #  legend.position = "none",
  # legend.title=element_blank(),
  #panel.grid.major = element_blank(),
  #panel.grid.minor = element_blank(),
  #axis.text.x = element_text(angle = 90, hjust = 1)
theme_bw() + 
  theme(
    axis.text.x = element_text(angle = 90, size = 11 ),
    axis.title.x = element_blank(),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank()
  )  -> FdsRNA


subsetNacidssRNA1 <- subset_with_more_than[subset_with_more_than$nacid == "ssRNA(+)",]


ggplot(subsetNacidssRNA1, aes(x = CT, y = logll, fill=Abbreviation)) + 
  #geom_boxplot( alpha = 0.4) +
  geom_point(aes(colour=Abbreviation, shape=LOD), position = position_jitterdodge(jitter.width = 0.2), size = 2, alpha=0.7) +
  scale_x_log10()+
  # theme_ipsum(axis= TRUE,
  #           grid = FALSE, axis_text_size = 11, 
  #          axis_title_size = 11,
  #         axis_col = "black"
  #        )+ 
  # theme(
  #  legend.position = "none",
  # legend.title=element_blank(),
  #panel.grid.major = element_blank(),
  #panel.grid.minor = element_blank(),
  #axis.text.x = element_text(angle = 90, hjust = 1)
theme_bw() + 
  theme(
    axis.text.x = element_text(angle = 90, size = 11 ),
    axis.title.x = element_blank(),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank()
  )  -> FssRNAp


subsetNacidssRNA2 <- subset_with_more_than[subset_with_more_than$nacid == "ssRNA(-)",]

ggplot(subsetNacidssRNA2, aes(x = CT, y = logll, fill=Abbreviation)) + 
  #geom_boxplot( alpha = 0.4) +
  geom_point(aes(colour=Abbreviation, shape=LOD), position = position_jitterdodge(jitter.width = 0.2), size = 2, alpha=0.7) +
  scale_x_log10()+
  # theme_ipsum(axis= TRUE,
  #           grid = FALSE, axis_text_size = 11, 
  #          axis_title_size = 11,
  #         axis_col = "black"
  #        )+ 
  # theme(
  #  legend.position = "none",
  # legend.title=element_blank(),
  #panel.grid.major = element_blank(),
  #panel.grid.minor = element_blank(),
  #axis.text.x = element_text(angle = 90, hjust = 1)
theme_bw() + 
  theme(
    axis.text.x = element_text(angle = 90, size = 11 ),
    axis.title.x = element_blank(),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank()
  )  -> FssRNAm

grid.arrange( FdsRNA, FssRNAp, FssRNAm, nrow= 1, ncol=3, 
            widths=c(8, 8, 8), heights = c(1)) -> Fs

FdsRNA
FssRNAp
FssRNAm
Fs
```




##Family over number datapoints
###organise data
```{r}
tmp=as.matrix (table(dat$`Studies by number`, dat$fam))
meltd2<- melt (tmp)
```

###plot
```{r}

#plot in blue
ggplot(meltd2, aes(x=Var2, y=value))+  geom_bar(stat="identity", aes(x=Var2, y=value, fill=Var1), colour = "black") +
  labs( y= "number of datapoints",  col="red") +
  theme_bw() +
  theme(
    axis.text.x = element_text(angle = 90) ,
    legend.position = "none",
    axis.title.x = element_blank()
    )-> obj4
obj4

ggsave("family_datapoints_blue.jpeg", plot = obj4,
       scale = 1, width = 20, height = 10, units = "cm", dpi = 1200)

###or in grey 
ggplot(meltd2, aes(x=Var2, y=value))+  geom_bar(stat="identity",  colour = "black", fill = "#808080") + 
  labs( y= "number of datapoints") +  
  theme_bw() + 
  theme(
    axis.text.x = element_text(angle = 90, size = 12 ),
        axis.title.x = element_blank(),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank()
        )-> obj5
obj5

ggsave("family_datapoints_grey.jpeg", plot = obj5,
       scale = 1, width = 20, height = 10, units = "cm", dpi = 1200)

```

##Temperature
```{r}
table(dat$Temp)
dat$Temp <- as.numeric(dat$Temp)


ggplot(dat, aes(x=Temp)) +
  geom_histogram(position="identity", alpha=0.5,breaks = seq(0,50,1) , binwidth=50, color="black", fill="grey45") +
  scale_y_continuous(expand = c(0,0),
                       limits = c(0,400)) +
  scale_x_continuous(expand = c(0,0),
                     limits = c(0,50), 
                     breaks=seq(0,50,10)) +
  labs( y= "Number of Data Points", x = "Temperature [Â°C]") +
  theme(axis.text.y   = element_text(size=16),
        axis.text.x   = element_text(size=16),
        axis.title.y  = element_text(size=16),
        axis.title.x  = element_text(size=16)) + 
  theme_ipsum(axis= TRUE,
              grid = FALSE, axis_text_size = 11, 
              axis_title_size = 11,
              axis_col = "black"
              ) ->obj6


ggsave("temperature_distribution.jpeg", plot = obj6,
       scale = 1, width = 20, height = 10, units = "cm", dpi = 1200)


#original R 

###temperature
par(mfrow = c(1, 1), mar=c(6,5,3,2))
hist(as.numeric(dat$Temp), seq(0,50,2), 
     main = "distribution of temperature" , ylab = "amount of data points", xlab = "temperature in ?C",
     col= c("#3300CC","#3300CC","#3300CC","#3300CC",
            "#3300FF","#3300FF","#3300FF","#3300FF",
            "#CC00FF","#CC00FF","#CC00FF","#CC00FF",
            "#CC00CC","#CC00CC","#CC00CC","#CC00CC",
            "#CC0099","#CC0099","#CC0099","#CC0099","#CC0099","#CC0099","#CC0099","#CC0099","#CC0099"
     ))

###temperature_e
par(mfrow = c(2, 1), mar=c(6,5,3,2))
hist(as.numeric(dat.e$Temp), seq(0,50,2), 
     main = "distribution of temperature enveloped" , ylab = "amount of data points", xlab = "temperature in ?C",
     col= c("#3300CC","#3300CC","#3300CC","#3300CC",
            "#3300FF","#3300FF","#3300FF","#3300FF",
            "#CC00FF","#CC00FF","#CC00FF","#CC00FF",
            "#CC00CC","#CC00CC","#CC00CC","#CC00CC",
            "#CC0099","#CC0099","#CC0099","#CC0099","#CC0099","#CC0099","#CC0099","#CC0099","#CC0099"
     ))
###temperature_n
par( mar=c(6,5,3,2))
hist(as.numeric(dat.n$Temp), seq(0,50,2), 
     main = "distribution of temperature nonenveloped" , ylab = "amount of data points", xlab = "temperature ",
     col= c("#3300CC","#3300CC","#3300CC","#3300CC",
            "#3300FF","#3300FF","#3300FF","#3300FF",
            "#CC00FF","#CC00FF","#CC00FF","#CC00FF",
            "#CC00CC","#CC00CC","#CC00CC","#CC00CC",
            "#CC0099","#CC0099","#CC0099","#CC0099","#CC0099","#CC0099","#CC0099","#CC0099","#CC0099"
     ))
  
```
####Carbon load
```{r}

par(mfrow = c(1, 1))
grid(nx = NA, ny=7, col="lightgray")##
par(mar=c(6,5,4,2))
plot(log ~ CT, data=dat, pch=19, cex=0.5, log="x", 
     main="distribution of carbon load", xlab="CT value logarithmic [concentracion * time]", ylab="log reduction",
     col=ifelse(is.na(dat$matrix) , "turquoise3", "tan4"))
legend("topright", y=6,legend = c( " without carbon load" , " with carbon load"), col= c("turquoise3" , "tan4" ),pch= c(19,19), cex=0.7 )

```
###  Surface materials
```{r}
### Experimental Surface materials

par(mfrow = c(1, 2), mar=c(7,5,2,1))
barplot(table(dat$material), las=2, 
        ylab = "amount of data points", 
        col= "grey40", cex.names = 1.1, cex.axis = 1.1, )
box(which="plot", bty="]")
par( mar=c(8,5,2,1))
tmpmat <- as.matrix (table(dat$`Studies by number`, dat$material))
tmpmat [tmpmat > 1] <- 1
barplot(tmpmat, las=2 , cex.names = 1.1, cex.axis = 1.1, 
        ylab = "amount of studies")
box(which="plot", bty="]")


###plot 2 Surface matierials

tmpMaterial=as.matrix (table(dat$`Studies by number`, dat$material))
meltM2<- melt (tmpMaterial)

ggplot(meltM2, aes(x=Var2, y=value))+  geom_bar(stat="identity",  colour = "black", fill = "#808080")-> obj1
obj1 + labs( y= "number of datapoints") -> obj2
obj2 +   theme_bw() + theme(axis.text.x = element_text(angle = 90) )-> obj3
obj3 +  theme(axis.title.x = element_blank())-> obj4
obj4

ggsave("SurfaceMaterial.jpeg", plot = obj4,
       scale = 1, width = 40, height = 20, units = "cm", dpi = 1200)

```


##CT distribution
```{r}
table(dat$CT)
dat$CT <- as.numeric(dat$CT)


ggplot(dat, aes(x=CT)) +
  geom_histogram(position="identity", alpha=0.5, color="black", fill="grey45"
                    , breaks = seq(0,1e+06,10000) 
                 ) +
  scale_y_log10(expand = c(0, 0)) +  # Scale y-axis in log10
  # scale_y_continuous(expand = c(0,0),
  #                      limits = c(0,400)) +
  # scale_x_continuous(expand = c(0,0),
  #                    limits = c(0,50), 
  #                    breaks=seq(0,50,10)) +
  labs( y= "Number of Data Points", x = "CT [mg*min/l]") +
  theme(axis.text.y   = element_text(size=16),
        axis.text.x   = element_text(size=16),
        axis.title.y  = element_text(size=16),
        axis.title.x  = element_text(size=16)) + 
  theme_ipsum(axis= TRUE,
              grid = FALSE, axis_text_size = 11, 
              axis_title_size = 11,
              axis_col = "black"
              ) ->objCT1

objCT1


ggsave("CT_distribution_all.jpeg", plot = objCT1,
       scale = 1, width = 40, height = 20, units = "cm", dpi = 1200)

ggplot(dat, aes(x=CT)) +
  geom_histogram(position="identity", alpha=0.5, color="black", fill="grey45"
                 , breaks = seq(0,5e+04,1000) 
                 ) +
  scale_y_log10(expand = c(0, 0)) +  # Scale y-axis in log10
  # scale_y_continuous(expand = c(0,0),
  #                      limits = c(0,400)) +
  # scale_x_continuous(expand = c(0,0),
  #                    limits = c(0,50), 
  #                    breaks=seq(0,50,10)) +
  labs( y= "Number of Data Points", x = "CT [mg*min/l]") +
  theme(axis.text.y   = element_text(size=16),
        axis.text.x   = element_text(size=16),
        axis.title.y  = element_text(size=16),
        axis.title.x  = element_text(size=16)) + 
  theme_ipsum(axis= TRUE,
              grid = FALSE, axis_text_size = 11, 
              axis_title_size = 11,
              axis_col = "black"
              ) ->objCT2

objCT2

ggsave("CT_distribution_5e+04.jpeg", plot = objCT2,
       scale = 1, width = 40, height = 20, units = "cm", dpi = 1200)


  
```

## Surface materials
```{r}

tmpMaterial=as.matrix (table(dat$`Studies by number` , dat$material))
meltM2<- melt (tmpMaterial)

ggplot(meltM2, aes(x=Var2, y=value))+  geom_bar(stat="identity",  colour = "black", fill = "#808080") + 
  labs( y= "number of datapoints") +
  theme_ipsum(axis= TRUE,
              grid = FALSE, axis_text_size = 11, 
              axis_title_size = 11,
              axis_col = "black"
              )+
  theme(axis.text.x = element_text(angle = 90) )+
  theme(axis.title.x = element_blank())-> obj7

obj7

ggsave("Surface material.jpeg", plot = obj7,
       scale = 1, width = 20, height = 10, units = "cm", dpi = 1200)

```
##nucleic acid type in R
```{r}
###nucleic acid type


par(mar=c(3,5,2,2), mfrow = c(1, 1))
barplot(table(dat$nacid), ylim=c(0,500),
        main="distribution of nucleic acid types",ylab = "amount of data points",
        col=c ("red","yellow","green", "blue", "purple"))
par(mfrow = c(1,2))
barplot(table(dat.e$nacid), ylim=c(0,400),
        main="distribution of nucleic acid types enveloped viruses",ylab = "amount of data points",
        col=c ("red", "blue", "purple"))
barplot(table(dat.n$nacid), ylim=c(0,400),
        main="distribution of nucleic acid types nonenveloped viruses",ylab = "amount of data points",
        col=c ("red","yellow","green", "purple"))



```
## !!! Genome size 
```{r}
par(mfrow = c(1, 1), mar=c(6,5,4,1))
hist(log (dat$Gsize, 10), breaks = 36, ylim = c(0,250), 
     main = "distribution of Genome size", xlim= c(0.1,3.2), ylab = "amount of data points", xlab = "Genome size [kilo bases]", xaxt="n",
     col= "grey30")
axis(1, at= c(log(1,10),log(2,10),1,log(20,10),2,log(200,10),3), labels= c(1,2,10^1,20^1, 10^2,200, 10^3))


par(mar=c(5,5,4,1))
hist(dat$Gsize, breaks = 50, ylim = c(0,700),
     main = "distribution of Genome size", ylab = "amount of data points", xlab = "Genome size [kilo bases]",
     col= "grey30")

#ggplot
ggplot(dat, aes(x=Gsize) )+
  geom_histogram(
    position="identity", 
    alpha=0.5,breaks = seq(0,1200,50) , 
    binwidth=10,
  color="black", 
  fill="grey45" 
 ) + 
  scale_y_continuous(expand = c(0,0),
                       limits = c(0,175)) +
  scale_x_continuous(expand = c(0,0),
                     limits = c(0,1250), 
                     breaks=seq(0,1200,100)) +
  labs( y= "number of Data Points", x = "Genome size [kilo bases]") +
  theme(axis.text.y   = element_text(size=16),
        axis.text.x   = element_text(size=16),
        axis.title.y  = element_text(size=16),
        axis.title.x  = element_text(size=16)) + theme_bw() 

```

##Size historgram 
```{r}

h1 = hist(dat.n$size,plot=FALSE, breaks = seq(0,600,50))
h2 = hist(dat.e$size,plot=FALSE, breaks = seq(0,600,50))
data <- rbind(h2$counts, h1$counts) 

colnames(data) <- c(h2$breaks[h1$breaks>0])
rownames(data) <- c("nonenveloped","enveloped")


# Get the stacked barplot
par(mfrow= c(1,1) ,mar=c(6,5,4,1))
barplot(data, 
        col=c(rgb(0,0,1,0.5), 
              rgb(1,0,0,0.5)) ,
        border="white", 
        space=0.04, 
        font.axis=2,
        xlab="virus size [nm]", 
        ylab= "number of data ponts",
        cex.names = 1.1, cex.axis = 1.1, cex.lab =1.1)

legend("topright", legend=c("enveloped","nonenveloped"), col=c(rgb(0,0,1,0.5), 
                                                               rgb(1,0,0,0.5)), pt.cex=2, pch=15 , cex=1.5)
box(which="plot", bty="]")
```
##Size in traditional R
```{r}


par(mfrow = c(1, 2))
plot(dat.e$CT [dat.e$size < 100], 
     dat.e$log[dat.e$size < 100], 
     main= "enveloped viruses", xlab ="CT factor", ylab ="log reduction",
     pch=19,  cex=0.7, log = "x", xlim=c(0.9,1000000), ylim=c(-1,7),
     col=ifelse(dat.e$size [dat.e$size < 100] < 100 , "orange", "darkred"))
points(dat.e$CT [dat.e$size >= 100 & dat.e$size <150], 
       dat.e$log[dat.e$size >= 100 & dat.e$size <150],
       pch=19,  cex=0.7,
       col=ifelse(dat.e$size [dat.e$size >= 100 & dat.e$size <150] >= 100 
                  & dat.e$size [dat.e$size >= 100 & dat.e$size <150] < 150, "green", "darkred"))
points(dat.e$CT [dat.e$size >= 150 & dat.e$size <200], 
       dat.e$log[dat.e$size >= 150 & dat.e$size <200],
       pch=19,  cex=0.7,
       col=ifelse(dat.e$size [dat.e$size >= 150 & dat.e$size <200] >= 150 & 
                    dat.e$size [dat.e$size >= 150 & dat.e$size <200] < 200, "blue", "darkred"))
points(dat.e$CT [dat.e$size > 200], 
       dat.e$log[dat.e$size > 200], 
       pch=19,  cex=0.7, 
       col=ifelse(dat.e$size [dat.e$size > 200] > 200 , "red", "darkred"))
legend("topleft", legend=c( "<100 nm", "100-150 nm", "150-200 nm", ">200 nm"), 
       col = c("orange","green","blue", "red"),
       pch=c(19 ), cex=0.9, border=NA)


plot(dat.n$CT [dat.n$size < 35], 
     dat.n$log[dat.n$size < 35], 
     main= "non-enveloped viruses", xlab ="CT factor", ylab ="log reduction",
     pch=19,  cex=0.7, log = "x", xlim=c(0.9,1000000), ylim=c(-1,7),
     col=ifelse(dat.n$size [dat.n$size < 35] < 35 , "orange", "darkred"))
points(dat.n$CT [dat.n$size >= 35 & dat.n$size <70], 
       dat.n$log[dat.n$size >= 35 & dat.n$size <70],
       pch=19,  cex=0.7,
       col=ifelse(dat.n$size [dat.n$size >= 35 & dat.n$size <70] >= 35 
                  & dat.n$size [dat.n$size >= 35 & dat.n$size <70] < 70, "green", "darkred"))
points(dat.n$CT [dat.n$size >= 70 & dat.n$size <200], 
       dat.n$log[dat.n$size >= 70 & dat.n$size <200],
       pch=19,  cex=0.7,
       col=ifelse(dat.n$size [dat.n$size >= 100 & dat.n$size <200] >= 100 & 
                    dat.n$size [dat.n$size >= 100 & dat.n$size <200] < 200, "blue", "darkred"))
points(dat.n$CT [dat.n$size > 200], 
       dat.n$log[dat.n$size > 200], 
       pch=19,  cex=0.7, 
       col=ifelse(dat.n$size [dat.n$size > 200] > 200 , "red", "darkred"))
legend("topleft", legend=c( "<35 nm", "35-75 nm", "75-200 nm", ">200 nm"), 
       col = c("orange","green","blue", "red"),
       pch=c(19 ), cex=0.9, border=NA)

###########################################

####size non enveloped in 4 frames

par(mfrow = c(2, 2))
plot(dat.n$CT [dat.n$size < 35], 
     dat.n$log[dat.n$size < 35], 
     main= "non-enveloped viruses <35 nm", xlab ="CT factor", ylab ="log reduction value",
     pch=19,  cex=0.7, log = "x", xlim=c(10,10000000), ylim=c(-1,7),
     col=ifelse(dat.n$size [dat.n$size < 35] < 35 , "orange", "darkred"),
     xaxt = "n")
axis(axis(1, at = c( 1, 10, 100, 1000, 10000, 100000, 1000000, 10000000)))
plot(dat.n$CT [dat.n$size >= 35 & dat.n$size <70], 
     dat.n$log[dat.n$size >= 35 & dat.n$size <70],
     main= "non-enveloped viruses 35-75 nm", xlab ="CT factor", ylab ="log reduction value",
     pch=19,  cex=0.7, log = "x", xlim=c(10,10000000), ylim=c(-1,7),
     col=ifelse(dat.n$size [dat.n$size >= 35 & dat.n$size <70] >= 35 
                & dat.n$size [dat.n$size >= 35 & dat.n$size <70] < 70, "darkgreen", "darkred"),
     xaxt = "n")
axis(axis(1, at = c( 1, 10, 100, 1000, 10000, 100000, 1000000, 10000000)))
plot(dat.n$CT [dat.n$size >= 70 & dat.n$size <200], 
     dat.n$log[dat.n$size >= 70 & dat.n$size <200], 
     main= "non-enveloped viruses 75-200 nm", xlab ="CT factor", ylab ="log reduction value",
     pch=19,  cex=0.7, log = "x", xlim=c(10,10000000), ylim=c(-1,7),
     col=ifelse(dat.n$size [dat.n$size >= 100 & dat.n$size <200] >= 100 & 
                  dat.n$size [dat.n$size >= 100 & dat.n$size <200] < 200, "blue", "darkred"),
     xaxt = "n")
axis(axis(1, at = c( 1, 10, 100, 1000, 10000, 100000, 1000000, 10000000)))
plot(dat.n$CT [dat.n$size > 200], 
     dat.n$log[dat.n$size > 200], 
     main= "non-enveloped viruses >200 nm", xlab ="CT factor", ylab ="log reduction value",
     pch=19,  cex=0.7, log = "x", xlim=c(10,10000000), ylim=c(-1,7),
     col=ifelse(dat.n$size [dat.n$size > 200] > 200 , "red", "darkred"),
     xaxt = "n")
axis(axis(1, at = c( 1, 10, 100, 1000, 10000, 100000, 1000000, 10000000)))
#legend("topleft", legend=c( "<35 nm", "35-75 nm", "75-200 nm", ">200 nm"), 
#      col = c("orange","green","blue", "red"),
#     pch=c(19 ), cex=0.8, border=NA)



######## Size enveloped in 4 frames

par(mfrow = c(2, 2))
plot(dat.e$CT [dat.e$size < 100], 
     dat.e$log[dat.e$size < 100], 
     main= "enveloped viruses < 100 nm", xlab ="CT factor", ylab ="log reduction value",
     pch=19,  cex=0.7, log = "x", xlim=c(10,1000000), ylim=c(-1,7),
     col=ifelse(dat.e$size [dat.e$size < 100] < 100 , "orange", "darkred"),
     xaxt = "n")
axis(axis(1, at = c( 1, 10, 100, 1000, 10000, 100000, 1000000)))
plot(dat.e$CT [dat.e$size >= 100 & dat.e$size <150], 
     dat.e$log[dat.e$size >= 100 & dat.e$size <150],
     main= "enveloped viruses 100-150 nm", xlab ="CT factor", ylab ="log reduction value",
     pch=19,  cex=0.7, log = "x", xlim=c(10,1000000), ylim=c(-1,7),
     col=ifelse(dat.e$size [dat.e$size >= 100 & dat.e$size <150] >= 100 
                & dat.e$size [dat.e$size >= 100 & dat.e$size <150] < 150, "green", "darkred"),
     xaxt = "n")
axis(axis(1, at = c( 1, 10, 100, 1000, 10000, 100000, 1000000)))
plot(dat.e$CT [dat.e$size >= 150 & dat.e$size <200], 
     dat.e$log[dat.e$size >= 150 & dat.e$size <200],
     main= "enveloped viruses 150-200 nm", xlab ="CT factor", ylab ="log reduction value",
     pch=19,  cex=0.7, log = "x", xlim=c(10,1000000), ylim=c(-1,7),
     col=ifelse(dat.e$size [dat.e$size >= 150 & dat.e$size <200] >= 150 & 
                  dat.e$size [dat.e$size >= 150 & dat.e$size <200] < 200, "blue", "darkred"),
     xaxt = "n")
axis(axis(1, at = c( 1, 10, 100, 1000, 10000, 100000, 1000000)))
plot(dat.e$CT [dat.e$size > 200], 
     dat.e$log[dat.e$size > 200], 
     main= "enveloped viruses >200 nm", xlab ="CT factor", ylab ="log reduction value",
     pch=19,  cex=0.7, log = "x", xlim=c(10,1000000), ylim=c(-1,7),
     col=ifelse(dat.e$size [dat.e$size > 200] > 200 , "red", "darkred"),
     xaxt = "n")
axis(axis(1, at = c( 1, 10, 100, 1000, 10000, 100000, 1000000)))
#legend("topleft", legend=c( "<100 nm", "100-150 nm", "150-200 nm", ">200 nm"), 
#      col = c("orange","green","blue", "red"),
#     pch=c(19 ), cex=0.9, border=NA)


```

## heatmap fam,strain,numb data points
```{r}

##new plot 1, Heatmap ggplot with tidy package
if (!require(tidyverse)) install.packages("tidyverse")
#install.packages("tidyverse")
library(ggplot2)
if (!require(ggnewscale)) install.packages("ggnewscale")
library(ggnewscale)

if (!require(reshape2)) install.packages("reshape2")
library(reshape2)

#collect and shape data 
#sum of points 
sumdp <- table(dat$fam)
head(t(sumdp))
sumdpf <- as.data.frame(sumdp)
sump = array(sumdpf[,2])

#sum of studies
tmpfam <-table(dat$`Studies by number` , dat$fam)
tmpfam[tmpfam > 1] <- 1
ct <-colSums (tmpfam, na.rm = FALSE, dims = 1)
cf <-as.data.frame(ct)

#sum of strain
tmps <-table(dat$Virus, dat$fam)
tmps[tmps > 1] <- 1
d1 <-colSums (tmps, na.rm = FALSE, dims = 1)
d <-as.data.frame(d1)
sums = array(d[,1])

#create vector with famimilie names 
cf$f <- c( "Adenoviridae" , "Alloherpesviridae", "Alphaherpesvirinae" ,     "Arteriviridae"     ,  "Asfarviridae"  ,     "Birnaviridae"   ,   "Caliciviridae" ,  "Circoviridae"     , "Coronaviridae"  , "Cystoviridae" , "Demerecviridae"    ,"Fiersviridae"      , "Flaviviridae" ,    "Hepadnaviridae"  ,      "Hepeviridae"  ,    "Herpesviridae"   ,    "Iridoviridae"   ,    "Microviridae"    ,    "Mimiviridae" ,       "Myoviridae"  ,  "Orthomyxoviridae", "Paramyxoviridae" ,     "Parvoviridae"   ,  "Picornaviridae"   ,   "Pneumoviridae"  ,    "polyomavirus"     ,  "Poxviridae ",     "Reoviridae"    ,  "Retroviridae" ,     "Rhabdoviridae"  ,     "Siphoviridae"  ,      "Togaviridae" ,      "Virgaviridae" )
           

#bind vectors to dataframe 
cf$s <-c(sums) 
cf$p <- c(sump)
cf <- cf[,c(2,1,3,4)]
#normalise
#cf$s <- cf$s/sum(cf$s)
#cf$p <- cf$p/sum(cf$p)
#cf$ct <- cf$ct/sum(cf$ct)

#reaorder and create tidy data frame 
cf <- cf[order(cf$p),]
names(cf)[1:4]<- c("f","Studies","Strains","Data points")
cfm <- melt(cf, id.vars=c("f"))

#headmap in bw
ggplot(cfm, aes(x=f, y=variable , fill = value))+
  scale_x_discrete (limits = c( "Adenoviridae" , "Alloherpesviridae", "Alphaherpesvirinae" ,     "Arteriviridae"     ,  "Asfarviridae"  ,     "Birnaviridae"   ,   "Caliciviridae" ,  "Circoviridae"     , "Coronaviridae"  , "Cystoviridae" , "Demerecviridae"    ,"Fiersviridae"      , "Flaviviridae" ,    "Hepadnaviridae"  ,      "Hepeviridae"  ,    "Herpesviridae"   ,    "Iridoviridae"   ,    "Microviridae"    ,    "Mimiviridae" ,       "Myoviridae"  ,  "Orthomyxoviridae", "Paramyxoviridae" ,     "Parvoviridae"   ,  "Picornaviridae"   ,   "Pneumoviridae"  ,    "polyomavirus"     ,  "Poxviridae ",     "Reoviridae"    ,  "Retroviridae" ,     "Rhabdoviridae"  ,     "Siphoviridae"  ,      "Togaviridae" ,      "Virgaviridae" ))+
  scale_y_discrete (limits = c("Data points", "Studies", "Strains"))+
  geom_tile(data = filter(cfm, variable == "Data points"), aes(x=f, y=variable, fill = value),
            color = "white",lwd =.5,linetype = 1) +
  scale_fill_gradient2(low = "grey59", mid = "grey25", high = "grey0", midpoint = 80, name = "Data points") +
  
  new_scale_fill() +
  geom_tile(data = filter(cfm, variable == "Strains"), aes(x=f, y=variable, fill = value),
            color = "white",lwd = .5,linetype = 1) +
  scale_fill_gradient2(low = "grey59", mid = "grey25", high = "grey0", midpoint = 8, name = "Nr strains") +
  
  new_scale_fill() +
  geom_tile(data = filter(cfm, variable == "Studies"), aes(x=f, y=variable, fill = value),
            color = "white",lwd = .5,linetype = 1) +
  scale_fill_gradient2(low = "grey59", mid = "grey25", high = "grey0", midpoint = 8, name = "Nr studies") +
  xlab(label = "virus families") +
  theme_bw()+
  theme(axis.title.y = element_blank(),
        axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size = 15),
        axis.text.y = element_text(angle = 0, vjust = 0.5, hjust=1, size = 15),# lables vertical
        strip.text.y = element_blank(), #remove facet bar on y 
        legend.position="none")  + 
  geom_text(aes(label = value), color = "white", size = 5) -> Fheat

Fheat

ggsave("Fheat.jpeg", plot = Fheat,
       scale = 1, width = 40, height = 20, units = "cm", dpi = 1200)

```
# ANALYSIS


#thinks to do
```{r}

#exclude LODs or set boundrys
#exclude PCR or analysise differences
#subset liquid and Surface
#subset e and non maybe?
#subset CT
#subset BAC

#make analysis for subsets of families? like families with more than 100 datapoints or so?


```

###single linear regression models per factor 
```{r}
# Custom function to calculate SEM
sem <- function(x) {
  sd(x) / sqrt(length(x))
}


# size 
lmSfelog = lm(dat.e$logll ~ log(dat.e$CT,10) +  dat.e$size)
summary(lmSfelog)
lmSfnlog = lm(dat.n$logll ~ log(dat.n$CT,10) +   dat.n$size)
#lmSfnlog = lm(dat.n$logll[dat.n$size<200] ~ dat.n$CT[dat.n$size<200] +dat.n$size[dat.n$size<200])
summary(lmSfnlog)
lmSflog = lm(dat$logll ~ log(dat$CT,10) +   dat$size)
#lmSfnlog = lm(dat.n$logll[dat.n$size<200] ~ dat.n$CT[dat.n$size<200] +dat.n$size[dat.n$size<200])
summary(lmSflog)

#Temperature
lmTlog = lm(dat$logll ~ log(dat$CT,10) + as.numeric(dat$Temp))
lmTlog
summary(lmTlog)

#carbon
binsforcarbon <- dat$`carbon load`
binsforcarbon [(is.na(dat$`carbon load`))] = "n"
binsforcarbon [(!is.na(dat$`carbon load`))] = "c"

binsforcarbone<-dat.e$`carbon load`
binsforcarbone [(is.na(dat.e$`carbon load`))] = "n"
binsforcarbone [(!is.na(dat.e$`carbon load`))] = "c"

binsforcarbonn<-dat.n$`carbon load`
binsforcarbonn [(is.na(dat.n$`carbon load`))] = "n"
binsforcarbonn [(!is.na(dat.n$`carbon load`))] = "c"

dat$carbon <- c(binsforcarbon)
dat.e$carbon <- c(binsforcarbone)
dat.n$carbon <- c(binsforcarbonn)

c_mean <- c (mean(dat$logll[dat$carbon == "n"]), mean(dat$logll[dat$carbon == "c"]))
c_sem <- c (sem(dat$logll[dat$carbon == "n"]), sem(dat$logll[dat$carbon == "c"]))
c_sd <- c (sd(dat$logll[dat$carbon == "n"]), sd(dat$logll[dat$carbon == "c"]))

rm(binsforcarbon)
rm(binsforcarbone)
rm(binsforcarbonn)


# barplot
par(mfrow = c(1, 3))
barx <- barplot(c_mean,
                names.arg=c("no C","with C"),
                ylim=c(0,ceiling(max(dat$logll))),
                xlab='carbonload',
                ylab='log reduction')
error.bar(barx, c_mean,c_sem)

###e
c_meane <- c (mean(dat.e$logll[dat.e$carbon == "n"]), mean(dat.e$logll[dat.e$carbon == "c"]))
c_seme <- c (sem(dat.e$logll[dat.e$carbon == "n"]), sem(dat.e$logll[dat.e$carbon == "c"]))
# barplot
barx <- barplot(c_meane, main="enveloped", 
                names.arg=c("no C","with C"),
                ylim=c(0,ceiling(max(dat.e$logll))),
                xlab='carbonload',
                ylab='log reduction')
error.bar(barx, c_meane,c_seme)

##n
c_meann <- c (mean(dat.n$logll[dat.n$carbon == "n"]), mean(dat.n$logll[dat.n$carbon == "c"]))
c_semn <- c (sem(dat.n$logll[dat.n$carbon == "n"]), sem(dat.n$logll[dat.n$carbon == "c"]))
# barplot
barx <- barplot(c_meann,main="nonenveloped", 
                names.arg=c("no C","with C"),
                ylim=c(0,ceiling(max(dat.n$logll))),
                xlab='carbonload',
                ylab='log reduction')
error.bar(barx, c_meann,c_semn)


###########SSM 

lmTlog = lm(dat$logll ~ log(dat$CT,10)    )
summary(lmTlog)

lmTlog = lm(dat$logll ~ log(dat$CT,10)  +dat$Surface   )
summary(lmTlog)

################### multiple linear regression analysis


lmTlog = lm(dat$logll ~ log(dat$CT,10) +dat$size10 + dat$carbon + as.numeric(dat$Temp) +dat$Surface  + dat$Gsize + dat$ssRNAp+dat$ssRNA +dat$dsDNA +dat$dsRNA +dat$ssDNA   )
summary(lmTlog)
library(car)
vif(lmTlog)
alias(lmTlog) 


dat$Surface <-ifelse(dat$Surface == "e", 1,0)
dat$carbon <- as.numeric(dat$carbon)
df = data.frame(dat$logll, log(dat$CT,10),as.numeric(dat$size10) , dat$carbon , as.numeric(dat$Temp) ,dat$Surface  , dat$Gsize , dat$ssRNAp ,dat$dsDNA ,dat$dsRNA ,dat$ssDNA )
cor(df)
lm(df)
vif(lm(df))
alias(lm(df))

 cor(dat$Gsize,dat$size10)
 cor(dat$ssRNAp, dat$ssRNA)
 cor(dat$ssRNAp, dat$ssDNA)
 cor(dat$ssRNAp,dat$dsRNA)
 cor(dat$ssRNAp,dat$dsDNA)
 cor(dat$ssRNAp,dat$ssRNAp)
 cor(dat$ssRNAp,dat$carbon)
 cor(dat$ssRNAp,dat$Surface)



lmTlog = lm(dat$logll ~ log(dat$CT,10) +dat$size+ dat$carbon + as.numeric(dat$Temp) +dat$Surface  + dat$Gsize )
summary(lmTlog)
library(car)
vif(lmTlog) #no concern all vif< 5
lmTlog = lm(dat$logll ~ log(dat$CT,10) +dat$size+ dat$Gsize+ as.numeric(dat$Temp) +  dat$Surface )
summary(lmTlog)
lmTlog = lm(dat$logll ~ log(dat$CT,10) +dat$size+  as.numeric(dat$Temp) +  dat$Surface)
summary(lmTlog)
lmTlog = lm(dat$logll ~ log(dat$CT,10) +dat$size +  dat$Surface)
summary(lmTlog)
lmTlog = lm(dat$logll ~ log(dat$CT,10) + dat$Surface)
summary(lmTlog)
lmTlog = lm(dat$logll ~  dat$Surface)
summary(lmTlog)

lmTlog = lm(dat$logll ~ log(dat$CT,10) +dat$size+ dat$carbon+ as.numeric(dat$Temp) + dat$Gsize )
summary(lmTlog)

lmTlog = lm(dat$logll ~ log(dat$CT,10) +dat$size+  as.numeric(dat$Temp) + dat$Gsize)
summary(lmTlog)

lmTlog = lm(dat$logll ~ log(dat$CT,10) +dat$size+ as.numeric(dat$Temp))
summary(lmTlog)

##e
lmTlog = lm(dat.e$logll ~ log(dat.e$CT,10) +dat.e$size+ dat.e$carbon+ as.numeric(dat.e$Temp) + dat.e$Gsize)
summary(lmTlog)
lmTlog = lm(dat.e$logll ~ log(dat.e$CT,10) +dat.e$size+ dat.e$carbon+  dat.e$Gsize)
summary(lmTlog)
lmTlog = lm(dat.e$logll ~ log(dat.e$CT,10) +dat.e$size+  dat.e$Gsize)
summary(lmTlog)
lmTlog = lm(dat.e$logll ~ log(dat.e$CT,10) +dat.e$size)
summary(lmTlog)

###n 

lmTlog = lm(dat.n$logll ~ log(dat.n$CT,10) +dat.n$size+ dat.n$carbon+ as.numeric(dat.n$Temp) + dat.n$Gsize)
summary(lmTlog)
lmTlog = lm(dat.n$logll ~ log(dat.n$CT,10) +dat.n$size+ dat.n$carbon+ as.numeric(dat.n$Temp) )
summary(lmTlog)
lmTlog = lm(dat.n$logll ~ log(dat.n$CT,10) +dat.n$size+ as.numeric(dat.n$Temp) )
summary(lmTlog)

#check if temperature bigger 40 matters -see distribution
lmTlog = lm(dat.n$logll[dat.n$Temp < 40] ~ log(dat.n$CT[dat.n$Temp < 40],10) +dat.n$size[dat.n$Temp < 40]+ as.numeric(dat.n$Temp[dat.n$Temp < 40]) + dat.n$Gsize[dat.n$Temp < 40] + dat.n$carbon [dat.n$Temp < 40])
summary(lmTlog)

#n        double logarithmic skale, with log genome size 
lmTlog = lm(log(dat.n$logll,10) ~ log(dat.n$CT,10) +dat.n$size+ dat.n$carbon+ as.numeric(dat.n$Temp) + log(dat.n$Gsize,10))
summary(lmTlog)
lmTlog = lm(log(dat.n$logll,10) ~ log(dat.n$CT,10) +dat.n$carbon+ as.numeric(dat.n$Temp) + log(dat.n$Gsize,10))
summary(lmTlog)
lmTlog = lm(log(dat.n$logll,10) ~ log(dat.n$CT,10) +as.numeric(dat.n$Temp) + log(dat.n$Gsize,10))
summary(lmTlog)





#correlation Genome size to size 

cor.test(dat$size , dat$Gsize, method= "pearson")
cor.test(dat$size , dat$Gsize, method= "kendall")
cor.test(dat$size , dat$Gsize, method= "spearman")

cor.test(dat.n$size , dat.n$Gsize, method= "pearson")
cor.test(dat.n$size , dat.n$Gsize, method= "kendall")
cor.test(dat.n$size , dat.n$Gsize, method= "spearman")

cor.test(dat.e$size , dat.e$Gsize, method= "pearson")
cor.test(dat.e$size , dat.e$Gsize, method= "kendall")
cor.test(dat.e$size , dat.e$Gsize, method= "spearman")



#################################bac subset

bac <- subset(dat, (!is.na(dat$BAC)))
bac <- subset(dat, dat$BAC == "BAC")
lmbac = lm(bac$logll ~ log(bac$CT,10) +bac$size+ bac$carbon + as.numeric(bac$Temp) +bac$Surface  + bac$Gsize )
summary(lmbac)
vif(lmbac)
#remove Gsize because of correlation
lmbac = lm(bac$logll ~ log(bac$CT,10) +bac$size+ bac$carbon + as.numeric(bac$Temp) +bac$Surface)
#remove carbon load because of bios
lmbac = lm(bac$logll ~ log(bac$CT,10) + as.numeric(bac$Temp) +bac$Surface)

#distibutions bac;

#distribution corbon
sum(bac$carbon=="c")

c_mean <- c (mean(bac$logll[bac$carbon == "n"]), mean(bac$logll[bac$carbon == "c"]))

# barplot
par(mfrow = c(1, 3))
barx <- barplot(c_mean,
                names.arg=c("no C","with C"),
                ylim=c(0,ceiling(max(dat$logll))),
                xlab='carbonloadbac',
                ylab='log reduction')
#is to biost

#distribution envelope
sum(bac$carbon=="n")
#tempreture
par(mfrow = c(1, 1), mar=c(6,5,3,2))
hist(as.numeric(bac$Temp), seq(0,50,2), 
     main = "distribution of temperature bac" , ylab = "amount of data points", xlab = "temperature in ?C",
     col= c("#3300CC","#3300CC","#3300CC","#3300CC",
            "#3300FF","#3300FF","#3300FF","#3300FF",
            "#CC00FF","#CC00FF","#CC00FF","#CC00FF",
            "#CC00CC","#CC00CC","#CC00CC","#CC00CC",
            "#CC0099","#CC0099","#CC0099","#CC0099","#CC0099","#CC0099","#CC0099","#CC0099","#CC0099"
     ))

####size distribution 

mean(bac$size)
sd(bac$size)
hist(bac$size)
hist(dat$size)
```

